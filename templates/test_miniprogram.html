<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小程序跳转测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>🧪 小程序跳转路径测试</h5>
                    </div>
                    <div class="card-body">
                        <p>测试不同的页面路径，找到正确的跳转地址：</p>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="testPath('pages/index/index')">
                                📱 测试首页
                            </button>
                            
                            <button class="btn btn-info" onclick="testPath('pages/user/index')">
                                👤 测试我的页面
                            </button>
                            
                            <button class="btn btn-success" onclick="testPath('pages/mine/index')">
                                👤 测试mine页面
                            </button>
                            
                            <button class="btn btn-warning" onclick="testPath('pages/my/index')">
                                👤 测试my页面  
                            </button>
                            
                            <button class="btn btn-secondary" onclick="testPath('pages/profile/index')">
                                👤 测试profile页面
                            </button>
                            
                            <button class="btn btn-danger" onclick="testPath('')">
                                🏠 测试空路径（小程序默认页面）
                            </button>
                        </div>
                        
                        <hr>
                        <div class="mt-3">
                            <h6>自定义路径测试：</h6>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="customPath" 
                                       placeholder="输入页面路径，如：pages/xxx/index">
                                <button class="btn btn-outline-primary" onclick="testCustomPath()">
                                    测试自定义路径
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>📋 测试说明</h6>
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            1. 请在<strong>微信中</strong>打开此页面测试<br>
                            2. 点击按钮后观察是否成功跳转到小程序<br>
                            3. 记录能成功跳转的路径<br>
                            4. 如果都无法跳转，可能是AppID配置问题
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script>
        const MINIPROGRAM_APPID = 'wxd1e6e07fdfea7b7f';
        
        function testPath(path) {
            console.log('测试路径:', path);
            
            const code = 'TEST123'; // 测试兑换码
            const fullPath = path ? `/${path}?code=${code}` : `?code=${code}`;
            
            if (typeof wx !== 'undefined' && wx.miniProgram) {
                wx.miniProgram.navigateTo({
                    url: fullPath,
                    success: function() {
                        console.log('跳转成功:', path);
                        alert(`✅ 路径 "${path}" 跳转成功！`);
                    },
                    fail: function(res) {
                        console.log('跳转失败:', res);
                        
                        // 尝试使用redirectTo
                        wx.miniProgram.redirectTo({
                            url: fullPath,
                            success: function() {
                                alert(`✅ 路径 "${path}" 通过redirectTo跳转成功！`);
                            },
                            fail: function(res2) {
                                alert(`❌ 路径 "${path}" 跳转失败: ${JSON.stringify(res2)}`);
                            }
                        });
                    }
                });
            } else {
                // 不在微信环境或不支持，使用URL Scheme
                const schemeUrl = `weixin://dl/business/?appid=${MINIPROGRAM_APPID}&path=${path}&query=code=${encodeURIComponent(code)}&env_version=release`;
                window.location.href = schemeUrl;
                
                setTimeout(() => {
                    alert(`测试路径: ${path}\n如果没有跳转，说明此路径不可用`);
                }, 1000);
            }
        }
        
        function testCustomPath() {
            const customPath = document.getElementById('customPath').value.trim();
            if (customPath) {
                testPath(customPath);
            } else {
                alert('请输入页面路径');
            }
        }
        
        // 检查是否在微信环境
        function isWeixinBrowser() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.indexOf('micromessenger') !== -1;
        }
        
        window.onload = function() {
            if (!isWeixinBrowser()) {
                alert('⚠️ 请在微信中打开此页面进行测试');
            }
        };
    </script>
</body>
</html>